// üåê Exemplo de Cliente HTTP
#<http_client>
#<console_io>

println("=== Cliente HTTP ===");

// Configura√ß√µes globais do cliente HTTP
println("Configurando cliente HTTP...");
http_set_timeout(10000); // 10 segundos
http_set_user_agent("Dryad-HTTP-Client/1.0");

// GET simples
println("\n=== Requisi√ß√£o GET ===");
let url_get = "https://httpbin.org/get";
println("Fazendo GET para: " + url_get);

let resposta_get = http_get(url_get);
if (resposta_get != null) {
    println("‚úÖ GET bem-sucedido!");
    println("Resposta: " + resposta_get);
} else {
    println("‚ùå Erro na requisi√ß√£o GET");
}

// GET com par√¢metros
println("\n=== GET com Par√¢metros ===");
let url_params = "https://httpbin.org/get?nome=Dryad&versao=1.0";
let resposta_params = http_get(url_params);
if (resposta_params != null) {
    println("‚úÖ GET com par√¢metros bem-sucedido!");
} else {
    println("‚ùå Erro na requisi√ß√£o GET com par√¢metros");
}

// Verificar status da √∫ltima requisi√ß√£o
let status = http_status();
println("Status da √∫ltima requisi√ß√£o: " + status);

// Headers customizados
println("\n=== Headers Customizados ===");
http_set_headers("Content-Type: application/json\nAuthorization: Bearer token123");
let url_headers = "https://httpbin.org/headers";
let resposta_headers = http_get(url_headers);
if (resposta_headers != null) {
    println("‚úÖ GET com headers customizados!");
} else {
    println("‚ùå Erro na requisi√ß√£o com headers");
}

// POST com dados
println("\n=== Requisi√ß√£o POST ===");
let url_post = "https://httpbin.org/post";
let dados_post = '{"nome": "Dryad", "tipo": "linguagem", "versao": "1.0"}';

println("Fazendo POST para: " + url_post);
println("Dados: " + dados_post);

let resposta_post = http_post(url_post, dados_post);
if (resposta_post != null) {
    println("‚úÖ POST bem-sucedido!");
    println("Resposta: " + resposta_post);
} else {
    println("‚ùå Erro na requisi√ß√£o POST");
}

// Download de arquivo
println("\n=== Download de Arquivo ===");
let url_download = "https://httpbin.org/json";
let arquivo_destino = "download_teste.json";

println("Baixando: " + url_download);
println("Destino: " + arquivo_destino);

let sucesso_download = http_download(url_download, arquivo_destino);
if (sucesso_download) {
    println("‚úÖ Download conclu√≠do!");
} else {
    println("‚ùå Erro no download");
}

// Tratamento de JSON
println("\n=== Processamento de JSON ===");
let url_json = "https://httpbin.org/json";
let json_resposta = http_json(url_json);
if (json_resposta != null) {
    println("‚úÖ JSON recebido e processado!");
    println("Dados JSON: " + json_resposta);
} else {
    println("‚ùå Erro ao processar JSON");
}

// Fun√ß√£o utilit√°ria para testar conectividade
function testar_conectividade(url) {
    println("Testando conectividade para: " + url);
    let resultado = http_get(url);
    let status = http_status();
    
    if (resultado != null && status == 200) {
        println("‚úÖ Conectividade OK (Status: " + status + ")");
        return true;
    } else {
        println("‚ùå Problema de conectividade (Status: " + status + ")");
        return false;
    }
}

println("\n=== Teste de Conectividade ===");
testar_conectividade("https://httpbin.org/status/200");
testar_conectividade("https://httpbin.org/status/404");
testar_conectividade("https://httpbin.org/status/500");