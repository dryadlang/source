// Exemplo pr√°tico de Multithreading e Async/Await em Dryad
// Este exemplo demonstra as novas funcionalidades implementadas

// ===== FUN√á√ïES ASS√çNCRONAS =====

// Fun√ß√£o ass√≠ncrona para simular busca de dados
async function buscarDados() {
    print("Buscando dados do servidor...");
    return "dados_importantes";
}

// Fun√ß√£o ass√≠ncrona para processar dados
async function processarDados(dados) {
    print("Processando: " + dados);
    return "dados_processados";
}

// ===== FUN√á√ïES PARA THREADING =====

// Fun√ß√£o thread para processamento pesado
thread function calcularPesado() {
    print("Thread: Iniciando c√°lculo pesado...");
    let resultado = 42 * 1000;
    print("Thread: C√°lculo conclu√≠do!");
    return resultado;
}

// Fun√ß√£o thread para monitoramento
thread function monitorarSistema() {
    print("Thread: Monitorando sistema...");
    print("Thread: Sistema OK");
    return "sistema_saudavel";
}

// Fun√ß√£o thread com sincroniza√ß√£o
thread function tarefaSincronizada() {
    print("Thread sincronizada: Aguardando mutex...");
    // Simula√ß√£o de trabalho que precisa de sincroniza√ß√£o
    print("Thread sincronizada: Trabalho conclu√≠do!");
    return "trabalho_sincronizado";
}

// ===== PROGRAMA PRINCIPAL =====

print("=== Exemplo Dryad: Async/Threading ===");
print("");

// 1. Demonstra√ß√£o de Async/Await
print("1. Testando Async/Await:");
let dados = await buscarDados();
print("Dados recebidos: " + dados);

let processados = await processarDados(dados);
print("Dados processados: " + processados);
print("");

// 2. Demonstra√ß√£o de Threading
print("2. Testando Threading:");
let worker1 = thread(calcularPesado);
let worker2 = thread(monitorarSistema);

print("Threads iniciadas em paralelo!");
print("");

// 3. Demonstra√ß√£o de Mutex para sincroniza√ß√£o
print("3. Testando Mutex:");
let lock = mutex();
let workerSeguro = thread(tarefaSincronizada);

print("Thread segura criada com mutex!");
print("");

// 4. Exemplo combinado - Async + Threading
print("4. Exemplo combinado:");

async function coordenarTrabalho() {
    print("Coordenador: Iniciando coordena√ß√£o...");
    
    // Criar m√∫ltiplas threads
    let t1 = thread(calcularPesado);
    let t2 = thread(monitorarSistema);
    
    // Criar mutex para sincroniza√ß√£o
    let sharedLock = mutex();
    
    print("Coordenador: Todas as tarefas iniciadas!");
    return "coordenacao_completa";
}

let resultado = await coordenarTrabalho();
print("Resultado final: " + resultado);

print("");
print("=== Exemplo conclu√≠do com sucesso! ===");

// ===== DEMONSTRA√á√ÉO DE RECURSOS ADICIONAIS =====

// Fun√ß√£o para mostrar diferentes tipos de dados
function exemploTipos() {
    print("=== Tipos de dados suportados ===");
    
    // Arrays e opera√ß√µes
    let numeros = [1, 2, 3, 4, 5];
    print("Array: " + numeros[0]);
    
    // Tuplas
    let coordenadas = (10, 20, 30);
    print("Tupla: " + coordenadas.0);
    
    // Objetos
    let pessoa = {
        nome: "Jo√£o",
        idade: 30,
        ativo: true
    };
    print("Objeto: " + pessoa.nome);
    
    return "tipos_demonstrados";
}

// Executar demonstra√ß√£o de tipos
let tiposResult = exemploTipos();
print("Demo tipos: " + tiposResult);

// Exemplo com loops e controle de fluxo
function exemploControleFluxo() {
    print("=== Controle de fluxo ===");
    
    // For loop
    for (let i = 0; i < 3; i++) {
        print("Loop i: " + i);
    }
    
    // While loop
    let contador = 0;
    while (contador < 2) {
        print("While: " + contador);
        contador++;
    }
    
    // Foreach
    let cores = ["vermelho", "verde", "azul"];
    foreach (cor in cores) {
        print("Cor: " + cor);
    }
    
    return "controle_demonstrado";
}

let fluxoResult = exemploControleFluxo();
print("Demo fluxo: " + fluxoResult);

print("");
print("üéâ Dryad est√° funcionando perfeitamente com async/threading! üéâ");